import{r as s,k as u,l as g,J as R,j as n,n as a,R as b,S as _,F as w,Q as z,m as F,u as V,a7 as G,a8 as I,q as W,z as J}from"./element-plus-CdAUbEXj.js";import{_ as O,q as P,r as Q,t as j,v as H}from"./index-Cks_emWr.js";function N(S,v){return!v.replace(/[,;\n]+/g,",").split(",").filter(p=>p).some(p=>!S.test(p))}const K={class:"resource"},X={__name:"resource",setup(S){const v=s({labelWidth:"80px",inputWidth:"200px",fields:[{type:"text",label:"user/resource.name",name:"name"},{type:"text",label:"user/resource.access",name:"access"},{type:"text",label:"user/resource.cgi",name:"cgi"}]}),A=s({pageSize:10,pageSizes:[5,10,20,50],style:{"justify-content":"flex-end"}}),p=s([{label:"user/resource.index",type:"index",width:80},{label:"user/resource.name",prop:"name","min-width":100},{label:"user/resource.access",prop:"access",tdSlot:"access",wrap:!1},{label:"user/resource.cgi",prop:"cgi",tdSlot:"cgi",wrap:!1},{tdSlot:"operate",label:"public.operate",width:200,align:"center"}]),y=s(null),$=()=>{y.value.refresh()},T=async t=>{const{data:e}=await P(t);return{data:(e==null?void 0:e.list)||[],total:Number(e==null?void 0:e.total)||0}},L=async t=>{await Q({id:t._id}),j.success("成功"),y.value.refresh()},o=s(!1),h=s("添加"),d=s(null);let B=/^(\/[a-zA-Z-]+)+$/,D=/^(\/[a-zA-Z_]+)+$/;const E=s({labelWidth:"90px",inputWidth:"200px",fields:[{name:"id",attributes:{hide:!0},value:""},{component:"text",label:"user/resource.name",name:"name",validity:[{required:!0,message:"Name Required",trigger:"blur"}]},{component:"textarea",name:"access",label:"user/resource.access",attributes:{multiple:!0,style:{width:"280px"}},validity:[{required:!0,message:"Access Required",trigger:"blur"},{validator:(t,e,r)=>{if(!N(B,e))return r("Word error");r()},trigger:"blur"}]},{component:"textarea",name:"cgi",label:"user/resource.cgi",attributes:{multiple:!0,style:{width:"280px"}},validity:[{required:!0,message:"Cgi Required",trigger:"blur"},{validator:(t,e,r)=>{if(!N(D,e))return r("Word error");r()},trigger:"blur"}]}]}),M=()=>{o.value=!0,h.value="添加",W(()=>{var t;(t=d==null?void 0:d.value)==null||t.resetFields()})},U=t=>{var r,i;o.value=!0,h.value="编辑";let e=J(t);e.id=e._id,Array.isArray(e.access)&&(e.access=((r=e==null?void 0:e.access)==null?void 0:r.join(`
`))||""),Array.isArray(e.cgi)&&(e.cgi=((i=e==null?void 0:e.cgi)==null?void 0:i.join(`
`))||""),W(()=>{Object.assign(d.value.formModal,e)})},Z=async t=>{let e={},r=["id","name","access","cgi"],i=["access","cgi"];r.forEach(f=>{let c=t[f];c&&(i.includes(f)&&(c=c.replace(/[,;\n]+/g,",").split(",").filter(x=>x)),e[f]=c)}),(await H(e)).code===0&&($(),j.success("成功"),o.value=!1)},k=()=>{o.value=!1};return(t,e)=>{const r=u("el-button"),i=u("el-tag"),q=u("el-popconfirm"),f=u("pro-table"),c=u("pro-form"),x=u("el-dialog");return g(),R("div",K,[n(f,{ref_key:"table",ref:y,title:t.$t("user/resource.title"),request:T,columns:p.value,search:v.value,pagination:A.value},{toolbar:a(()=>[n(r,{plain:"",type:"default",icon:"Plus",onClick:M},{default:a(()=>[b(_(t.$t("user/resource.add")),1)]),_:1}),n(r,{plain:"",type:"default",icon:"Refresh",onClick:$},{default:a(()=>[b(_(t.$t("user/resource.refresh")),1)]),_:1})]),access:a(({row:l})=>[(g(!0),R(w,null,z((l==null?void 0:l.access)||[],(m,C)=>(g(),F(i,{key:C,type:"info",size:"small",effect:"plain",style:{"margin-right":"10px"}},{default:a(()=>[b(_(m),1)]),_:2},1024))),128))]),cgi:a(({row:l})=>[(g(!0),R(w,null,z((l==null?void 0:l.cgi)||[],(m,C)=>(g(),F(i,{key:C,type:"info",size:"small",effect:"plain",style:{"margin-right":"10px"}},{default:a(()=>[b(_(m),1)]),_:2},1024))),128))]),operate:a(l=>[n(r,{plain:"",circle:"",icon:V(G),type:"default",onClick:m=>U(l.row)},null,8,["icon","onClick"]),n(q,{width:"240","icon-color":"#626AEF","confirm-button-text":t.$t("public.confirm"),"cancel-button-text":t.$t("public.cancel"),title:t.$t("public.deleteTip"),onConfirm:m=>L(l.row)},{reference:a(()=>[n(r,{plain:"",circle:"",icon:V(I),type:"danger"},null,8,["icon"])]),_:2},1032,["confirm-button-text","cancel-button-text","title","onConfirm"])]),_:1},8,["title","columns","search","pagination"]),n(x,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value=l),onClose:k,class:"dialog"},{header:a(()=>[b(_(h.value),1)]),default:a(()=>[n(c,{ref_key:"proform",ref:d,config:E.value,onCancel:k,onSubmit:Z},null,8,["config"])]),_:1},8,["modelValue"])])}}},te=O(X,[["__scopeId","data-v-bbdf9114"]]);export{te as default};
