import{r as u,k as c,l as y,J as q,j as i,n as l,R as b,S as v,F as j,Q as z,m as A,u as w,a7 as U,a8 as J,q as F,z as O}from"./element-plus-CdAUbEXj.js";import{a as P,b as Q,c as H}from"./role-BYM-Viup.js";import{n as L,_ as K,t as V,q as X}from"./index-Cks_emWr.js";const Y=m=>L({url:"/role_resource/list",method:"post",data:m}),Z=m=>L({url:"/role_resource/modify",method:"post",data:m}),ee={class:"resource"},te={__name:"role",setup(m){const g=u(null),x=()=>{g.value.refresh()},M={labelWidth:"80px",inputWidth:"200px",fields:[{type:"text",label:"user/role.name",name:"name"}]},T=[{label:"user/role.index",type:"index",width:80},{label:"user/role.name",prop:"name","min-width":100},{label:"user/role.resource_id",prop:"resource_id",tdSlot:"resource",wrap:!1},{tdSlot:"operate",label:"public.operate",width:200,align:"center"}],W=async e=>{const t=await P(e);if(t.code!==0)return;let o=t.data.list||[],a=await Y({role_id:o.map(r=>r._id)});if(a.code!==0)return;let p=a.data.list.reduce((r,f)=>(r[f.role_id]=f.resource_id,r),{});return o.forEach(r=>{r.resource_id=p[r._id]||[]}),{data:o,total:t.data.total||0}},B=async e=>{await Q({id:e._id}),V.success("成功"),g.value.refresh()};let h=[],C=u({});async function k(e="",{page:t,limit:o}={page:0,limit:20}){let a=await X({name:e,page:t,limit:o});return a.code!==0?void 0:a.data.list.map(r=>({label:r.name,value:r._id}))}const n=u(!1),R=u("添加"),d=u(null),S=u({labelWidth:"90px",inputWidth:"200px",fields:[{name:"id",attributes:{hide:!0},value:""},{component:"text",label:"user/role.name",name:"name",validity:[{required:!0,message:"Name Required",trigger:"blur"}]},{component:"select",label:"user/role.resource_id",name:"resource_id",items:[],attributes:{multiple:!0,filterable:!0,remote:!0,loading:!1},events:{"remote-method":k},validity:[{required:!0,message:"Resource Required",trigger:"blur"}]}]});setTimeout(async()=>{h=await k("",{page:0,limit:1e3}),C=h.reduce((t,o)=>(t[o.value]=o.label,t),{});let e=S.value.fields.find(t=>t.name==="resource_id");e.items=h});const D=()=>{n.value=!0,R.value="添加",F(()=>{var e;(e=d==null?void 0:d.value)==null||e.resetFields()})},E=e=>{n.value=!0,R.value="编辑";let t=O(e);t.id=t._id,F(()=>{Object.assign(d.value.formModal,t)})},G=async e=>{let t={...e.id?{id:e.id}:{},name:e.name,resource_id:e.resource_id},o=await H(t);o.code!==0||(await Z({role_id:o.data.id,resource_id:t.resource_id})).code!==0||(x(),V.success("成功"),n.value=!1)},$=()=>{n.value=!1};return(e,t)=>{const o=c("el-button"),a=c("el-tag"),p=c("el-popconfirm"),r=c("pro-table"),f=c("pro-form"),I=c("el-dialog");return y(),q("div",ee,[i(r,{ref_key:"table",ref:g,title:e.$t("user/role.title"),request:W,columns:T,search:M},{toolbar:l(()=>[i(o,{icon:"Plus",onClick:D},{default:l(()=>[b(v(e.$t("user/role.add")),1)]),_:1}),i(o,{icon:"Refresh",onClick:x},{default:l(()=>[b(v(e.$t("user/role.refresh")),1)]),_:1})]),resource:l(({row:s})=>[(y(!0),q(j,null,z((s==null?void 0:s.resource_id)||[],(_,N)=>(y(),A(a,{key:N,type:"info",size:"small",effect:"plain",style:{"margin-right":"10px"}},{default:l(()=>[b(v(w(C)[_]||_),1)]),_:2},1024))),128))]),operate:l(s=>[i(o,{plain:"",circle:"",icon:w(U),type:"default",onClick:_=>E(s.row)},null,8,["icon","onClick"]),i(p,{width:"240","icon-color":"#626AEF","confirm-button-text":e.$t("public.confirm"),"cancel-button-text":e.$t("public.cancel"),title:e.$t("public.deleteTip"),onConfirm:_=>B(s.row)},{reference:l(()=>[i(o,{plain:"",circle:"",icon:w(J),type:"danger"},null,8,["icon"])]),_:2},1032,["confirm-button-text","cancel-button-text","title","onConfirm"])]),_:1},8,["title"]),i(I,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),onClose:$,class:"dialog"},{header:l(()=>[b(v(R.value),1)]),default:l(()=>[i(f,{ref_key:"proform",ref:d,config:S.value,onCancel:$,onSubmit:G},null,8,["config"])]),_:1},8,["modelValue"])])}}},ae=K(te,[["__scopeId","data-v-09616333"]]);export{ae as default};
